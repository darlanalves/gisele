!function(e){"use strict";function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;u=s=c=void 0,r=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,o);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(a)}var s=Object.getPrototypeOf(i);if(null===s)return void 0;e=s,t=o,n=a,r=!0}},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var r=this;if(n(this,e),!t)throw new Error("Invalid field config");Object.keys(t).forEach(function(e){return r[e]=t[e]})}return i(e,[{key:"parseValue",value:function(e){return this.isArray?this.parseArray(e):this.parse(e)}},{key:"parseArray",value:function(e){return Array.isArray(e)?e.map(this.parse,this):null}},{key:"parse",value:function(e){return e}},{key:"serialize",value:function(e){return e}}]),e}();o.register=new Map,o.create=function(e){var t=e.type,n=o.register.get(t)||f;return new n(e)};var a=function(e){function o(){n(this,o),r(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return t(o,e),i(o,[{key:"parse",value:function(e){return String(void 0!==e?e:"").trim()}},{key:"serialize",value:function(e){return"object"!=typeof e?String(e):void 0}}]),o}(o),u=function(e){function o(){n(this,o),r(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return t(o,e),i(o,[{key:"parse",value:function(e){return!!e}}]),o}(o),c=function(e){function o(){n(this,o),r(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return t(o,e),i(o,[{key:"parse",value:function(e){return e&&Number(e)||0}}]),o}(o),s=function(e){function o(){n(this,o),r(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return t(o,e),i(o,[{key:"parse",value:function(e){if(isFinite(e))return new Date(e);if("string"==typeof e){var t=Date.parse(e);return isFinite(t)?new Date(t):null}return null}},{key:"serialize",value:function(e){return e instanceof Date?e.toJSON():void 0}}]),o}(o),f=function(e){function o(){n(this,o),r(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return t(o,e),i(o,[{key:"parse",value:function(e){return null!==e?new this.type(e):null}},{key:"serialize",value:function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}}]),o}(o);o.register.set(String,a),o.register.set(Number,c),o.register.set(Boolean,u),o.register.set(Date,s);var l=function(){function e(){n(this,e)}return i(e,[{key:"toString",value:function(){return this.$$model.__name__}},{key:"toJSON",value:function(){return e.toJSON(this)}}],[{key:"toJSON",value:function(t){function n(t){var n=t.name,r=void 0;n in i&&(r=e.fieldToJSON(t,i[n])),void 0!==r&&(o[n]=r)}var r=[t.$$.data,t.$$.changed||{}],i={},o={};return r.forEach(function(e){Object.keys(e).forEach(function(t){i[t]=e[t]})}),e.iterateFields(t,n),o}},{key:"fieldToJSON",value:function(e,t){return e.isArray?t.map(e.serialize):e.serialize(t)}},{key:"isModel",value:function(t){return t instanceof e}},{key:"create",value:function(t){if("object"!=typeof t)throw new Error("Invalid model configuration");var n,r,i;t.fields?(n=t.name||"Model",r=t.fields||{},i=t.methods):(n="Model",r=t);var o=function(t){e.initialize(this,o),e.applyDefaultValues(this,o),e.applyValues(this,t)},a=Object.keys(r),u=a.map(function(t){return e.createField(t,r[t],o)}),c={name:n,fields:u,customMethods:i};return e.constructors.forEach(function(e){e(o,c)}),o}},{key:"defineProperty",value:function(t,n){var r=n.name,i=function(){return t.$$.get(r)},o=e.noop;n.readOnly||(o=function(e){e=n.parseValue(e),t.$$.set(r,e)});var a={enumerable:!0,get:i,set:o};Object.defineProperty(t,r,a)}},{key:"initialize",value:function(t,n){var r=n.__fields__;r.forEach(function(n){e.defineProperty(t,n)}),e.initializers.forEach(function(e){return e(t,n)})}},{key:"noop",value:function(){}},{key:"createField",value:function(e,t,n){if(!t)throw new Error("Invalid field config",t);"self"===t?t=n:"self"===t.type&&(t.type=n);var r=typeof t,i=t;if("function"===r&&(i={type:i}),i.name||(i.name=e),"function"!=typeof i.type)throw new Error("Invalid field type",i.type);return o.create(i)}},{key:"applyChanges",value:function(e,t,n){"object"==typeof t&&t?Object.keys(t).forEach(function(n){return e[n]=t[n]}):e[t]=n}},{key:"applyDefaultValues",value:function(t){function n(e){"default"in e&&t.$$.setPersistent(e.name,e["default"])}e.iterateFields(t,n)}},{key:"applyValues",value:function(t,n){function r(e){var r=e.name;if(r in n){var i=e.parseValue(n[r]);t.$$.setPersistent(r,i)}}n&&"object"==typeof n&&e.iterateFields(t,r)}},{key:"iterateFields",value:function(e,t){e.$$model.__fields__.forEach(t,e)}}]),e}();l.initializers=[],l.initializers.push(function(e,t){var n=p.create(t);Object.defineProperty(e,"$$",{enumerable:!1,value:n})}),l.initializers.push(function(e){Object.defineProperty(e,"$$dirty",{enumerable:!1,set:l.noop,get:function(){return e.$$.changed!==!1}})}),l.initializers.push(function(e,t){Object.defineProperty(e,"$$model",{enumerable:!1,writable:!1,value:t})}),l.constructors=[],l.constructors.push(function(e){var t=Object.create(l.prototype);t.constructor=e,e.prototype=t}),l.constructors.push(function(e,t){var n=t.name,r=t.fields,i={__fields__:r,__name__:n};Object.keys(i).forEach(function(t){Object.defineProperty(e,t,{value:i[t],writable:!1})})}),l.constructors.push(function(e,t){var n=t.customMethods;if(n){var r=t.fields.map(function(e){return e.name}),i=Object.keys(n);i.forEach(function(t){if(-1!==r.indexOf(t))throw new Error("Cannot override field "+t+" with a custom method of same name");e.prototype[t]=n[t]})}});var p=function(){function e(){n(this,e)}return i(e,[{key:"setPersistent",value:function(e,t){l.applyChanges(this.data,e,t)}},{key:"set",value:function(e,t){return this.changed||(this.changed={}),l.applyChanges(this.changed,e,t),this}},{key:"get",value:function(e){return this.changed&&e in this.changed?this.changed[e]:this.data[e]}},{key:"commit",value:function(){l.applyChanges(this.data,this.changed),this.changed=!1}},{key:"rollback",value:function(){this.changed=!1}}]),e}();p.create=function(){var e=new p;return e.data={},e.changed=!1,e},l.fn=p.prototype;var y={Model:l,Field:o};"function"==typeof define&&define.amd?define(function(){return y}):"undefined"!=typeof module&&module.exports?module.exports=y:e.Gisele=y}(this);