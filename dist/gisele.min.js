!function(e){"use strict";function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;u=f=c=void 0,r=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(a)}var f=Object.getPrototypeOf(o);if(null===f)return void 0;e=f,t=i,n=a,r=!0}},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){var r=this;if(n(this,e),!t)throw new Error("Invalid field config");Object.keys(t).forEach(function(e){return r[e]=t[e]})}return o(e,[{key:"parse",value:function(e){return e}}]),e}();i.create=function(e){switch(e.type){case String:return new a(e);case Number:return new c(e);case Boolean:return new u(e);case Date:return new f(e);default:return new s(e)}};var a=function(e){function i(){n(this,i),r(Object.getPrototypeOf(i.prototype),"constructor",this).apply(this,arguments)}return t(i,e),o(i,[{key:"parse",value:function(e){return String(void 0!==e?e:"").trim()}}]),i}(i),u=function(e){function i(){n(this,i),r(Object.getPrototypeOf(i.prototype),"constructor",this).apply(this,arguments)}return t(i,e),o(i,[{key:"parse",value:function(e){return!!e}}]),i}(i),c=function(e){function i(){n(this,i),r(Object.getPrototypeOf(i.prototype),"constructor",this).apply(this,arguments)}return t(i,e),o(i,[{key:"parse",value:function(e){return e&&Number(e)||0}}]),i}(i),f=function(e){function i(){n(this,i),r(Object.getPrototypeOf(i.prototype),"constructor",this).apply(this,arguments)}return t(i,e),o(i,[{key:"parse",value:function(e){if(isFinite(e))return new Date(e);if("string"==typeof e){var t=Date.parse(e);return new Date(t)}return null}}]),i}(i),s=function(e){function i(){n(this,i),r(Object.getPrototypeOf(i.prototype),"constructor",this).apply(this,arguments)}return t(i,e),o(i,[{key:"parse",value:function(e){return null!==e?new this.type(e):null}}]),i}(i),l=function(){function e(){n(this,e)}return o(e,[{key:"toString",value:function(){return this.$$.name}},{key:"toJSON",value:function(){return e.toJSON(this)}}]),e}();l.toJSON=function(e){var t=[e.$$.data,e.$$.changed||{}],n={};return t.forEach(function(e){Object.keys(e).forEach(function(t){var r=e[t];l.isModel(r)&&(r=r.toJSON()),r instanceof Date&&(r=r.toJSON()),n[t]=r})}),n},l.isModel=function(e){return e instanceof l},l.create=function(e){var t=e.name||"Model",n=e.fields||[],r=function(e){l.initialize(this,r),l.applyDefaultValues(this,r),l.applyValues(this,r,e)},o=Object.keys(n);n=o.map(function(e){return l.createField(e,n[e],r)});var i=Object.create(l.prototype);i.constructor=r,r.prototype=i;var a={__fields__:n,__name__:t,__model__:!0};Object.keys(a).forEach(function(e){Object.defineProperty(r,e,{value:a[e],writable:!1})});var u=e.methods;return u&&Object.keys(u).forEach(function(e){if(-1!==o.indexOf(e))throw new Error("Cannot override field "+e+" with a custom method of same name");var t=u[e];r.prototype[e]=function(){t.apply(this,arguments)}}),r},l.defineProperty=function(e,t){var n=t.name,r=function(){return e.$$.get(n)},o=l.noop;t.readOnly||(o=function(r){r=t.parse(r),e.$$.set(n,r)});var i={enumerable:!0,get:r,set:o};Object.defineProperty(e,n,i)},l.initialize=function(e,t){var n=t.__fields__;n.forEach(function(t){l.defineProperty(e,t)});var r=p.create(t);Object.defineProperty(e,"$$",{enumerable:!1,value:r}),Object.defineProperty(e,"$$dirty",{enumerable:!1,set:l.noop,get:function(){return e.$$.changed!==!1}})},l.noop=function(){},l.createField=function(e,t,n){if(!t)throw new Error("Invalid field config",t);"self"===t?t=n:"self"===t.type&&(t.type=n);var r=typeof t,o=t;if("function"===r&&(o={type:o}),o.name||(o.name=e),"function"!=typeof o.type)throw new Error("Invalid field type",o.type);return i.create(o)},l.applyChanges=function(e,t,n){"object"==typeof t&&t?Object.keys(t).forEach(function(n){return e[n]=t[n]}):e[t]=n},l.applyDefaultValues=function(e,t){t.__fields__.forEach(function(e){"default"in e&&this.$$.setPersistent(e.name,e["default"])},e)},l.applyValues=function(e,t,n){n&&"object"==typeof n&&t.__fields__.forEach(function(t){var r=t.name;if(r in n){var o=t.parse(n[r]);e.$$.setPersistent(r,o)}})};var p=function(){function e(){n(this,e)}return o(e,[{key:"setPersistent",value:function(e,t){l.applyChanges(this.data,e,t)}},{key:"set",value:function(e,t){return this.changed||(this.changed={}),l.applyChanges(this.changed,e,t),this}},{key:"get",value:function(e){return this.changed&&e in this.changed?this.changed[e]:this.data[e]}},{key:"commit",value:function(){l.applyChanges(this.data,this.changed),this.changed=!1}},{key:"rollback",value:function(){this.changed=!1}}]),e}();p.create=function(e){var t=new p;return t.data={},t.changed=!1,t.fields=e.__fields__,t.name=e.__name__,t};var y={Model:l,ModelMethods:p,Field:i,StringField:a,BooleanField:u,NumberField:c,CustomField:s};"function"==typeof define&&define.amd?define(function(){return y}):"undefined"!=typeof module&&module.exports?module.exports=y:e.Gisele=y}(this);